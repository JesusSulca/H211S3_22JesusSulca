<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:p="http://primefaces.org/ui"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">
    <h:head>
        <title>Listar Producto</title>
        <f:event listener="#{ProductoC.listar()}" type="preRenderView" />

    </h:head>
    <h:body >
        <p:menubar>
            <p:submenu label="Cliente">
                <p:menuitem value="registrar Cliente" outcome="index"/>
            </p:submenu>
            <p:submenu label="Ventas">
                <p:menuitem value="Realizar Venta" outcome="venta"/>
            </p:submenu>
        </p:menubar>

        <p:growl id="mensaje" severity="info, fatal , error" showDetail="true" showSummary="true" />
        <p:growl id="growl-sticky" for="sticky-key" showDetail="true" showSummary="true" />
        <center>
            Registro de Productos

            <!--            Formulario para registrar-->
            <h:form id="Registro">
                <!--                Panel grid-->
                <p:panelGrid  columns="2" >
                    <p:outputLabel value="Codigo" />
                    <p:inputText value="#{ProductoC.pro.codigo}" required="true" maxlength="5" style="text-align: center" id="Codigo" >
                        <p:keyFilter regEx="/[A-Za-z0-9 ]/" />
                    </p:inputText>

                    <p:outputLabel value="Nombre" />
                    <p:inputText value="#{ProductoC.pro.nombre}" required="true" style="text-align: center" id="nombre">
                        <p:keyFilter regEx="/[A-Z-a-z-ñ ]/" />
                    </p:inputText>

                    <p:outputLabel value="Precio" />
                    <p:inputText value="#{ProductoC.pro.precio}" required="true" id="Precio" style="text-align: center" maxlength="5" >
                        <p:keyFilter regEx="/[0-9.]/" />
                    </p:inputText>
                    <p:outputLabel for="tipo" value="Tipo: " style="text-align: center" />
                    <p:selectOneRadio id="tipo" value="#{ProductoC.pro.tipo}" 
                                      required="true" requiredMessage="Falta seleccionar" >
                        <f:selectItem itemLabel="Pizza" itemValue="P"  />
                    </p:selectOneRadio>
                    <p:outputLabel for="tamaño" value="Tamaño"/>
                    <p:selectOneRadio id="tamaño" value="#{ProductoC.pro.tamano}"
                                      required="true" requiredMessage="Falta seleccionar">
                        <f:selectItem itemLabel="XXL" itemValue="X"/>
                        <f:selectItem itemLabel="Individual" itemValue="I"/>
                        <f:selectItem itemLabel="Familiar" itemValue="F"/>
                    </p:selectOneRadio>
                    <p:outputLabel value="Stock" />
                    <p:inputText value="#{ProductoC.pro.stock}" maxlength="3" required="true" id="stock" style="text-align: center">
                        <p:keyFilter regEx="/[0-9]/" />
                    </p:inputText>
                    <p:outputLabel value="Descripción " />
                    <p:inputText value="#{ProductoC.pro.detalle}" required="true" id="detalle" style="text-align: center">
                        <p:keyFilter regEx="/[A-Za-zñÑ ]/" />
                    </p:inputText>
                </p:panelGrid>
            </h:form>
            <p:commandButton value="Registrar" actionListener="#{ProductoC.registrar()}" update=":MostrarProducto:tablapro Registro mensaje" />
            <p:commandButton value="Limpiar" actionListener="#{ProductoC.limpiar()}" update="Registro"/>

            <!--            <h:form >
                            <center>
                                <h:commandLink>
                                    <h:graphicImage url="/Image/excel.png" width="50px"/>
            
                                    <p:dataExporter type="xls" target="MostrarProducto:tablapro" fileName="Listado de Producto" />
                                </h:commandLink>
                            </center>
                        </h:form>-->

            <!--            Creación del formulario 2-->

            <h:form id="MostrarProducto">
                <p:dataTable id="tablapro" var="tblpro" value="#{ProductoC.listadoPro}" rows="5" 
                             selection="#{ProductoC.pro}" rowKey="#{tblpro.codigo}"
                             selectionMode="single" resizableColumns="true"
                             paginator="true"
                             paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
                             currentPageReportTemplate="{startRecord}-{endRecord} of {totalRecords} records"
                             rowsPerPageTemplate="1,5,{ShowAll|'All'}" >
                    <p:column headerText="Codigo" style="width: 65px ; text-align: center"   >
                        <h:outputText value="#{tblpro.codigo}" />
                    </p:column>  
                    <p:column headerText="Nombre" style="width: 250px ; text-align: center"  >
                        <h:outputText value="#{tblpro.nombre}"  />
                    </p:column> 
                    <p:column headerText="Precio" style="width: 90px ; text-align: center"  >
                        <h:outputText value="#{tblpro.precio}"  />
                    </p:column>    
                    <p:column headerText="Tipo" sortBy="#{tblpro.tipo}"  style="width: 70px ; text-align: center">
                        <h:outputText value="#{tblpro.tipo}">
                            <f:converter converterId="productoTipoConverter"/>
                        </h:outputText>

                    </p:column>
                    <p:column headerText="Tamaño" style="width: 100px ; text-align: center" >
                        <h:outputText value="#{tblpro.tamano}"  >
                            <f:converter converterId="productoConverter" />
                        </h:outputText>
                    </p:column>  
                    <p:column headerText="Stock"  style="width: 65px ; text-align: center"  >
                        <h:outputText value="#{tblpro.stock}"  />
                    </p:column>  
                    <p:column headerText="Detalle" style="width: 700px ; text-align: center"  >
                        <h:outputText value="#{tblpro.detalle}"  />
                    </p:column>  
                    <p:column headerText="Modificar" style="width: 70px ; text-align: center" >
                        <p:commandButton icon="ui-icon-pencil" oncomplete="PF('wdlgDatos').show();" update=":formModificar" >
                            <f:setPropertyActionListener value="#{tblpro}" target="#{ProductoC.pro}" />
                        </p:commandButton>

                    </p:column> 
                    <p:column  headerText="Eliminar" style="width: 70px ; text-align: center">
                        <p:commandButton icon="ui-icon-trash" actionListener="#{ProductoC.eliminar()}" update="tablapro"  >
                            <p:confirm header="Confirmación" message="¿Desea Eliminar?" icon="ui-icon-alert"/>
                            <p:tooltip trackMouse="true"/>
                        </p:commandButton>
                        <p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
                            <p:commandButton value="Si" type="button" styleClass="ui-confirmdialog-yes" icon="ui-icon-check"/>
                            <p:commandButton value="No" type="button" styleClass="ui-confirmdialog-no" icon="ui-icon-close"/>
                        </p:confirmDialog>
                    </p:column>
                </p:dataTable>
                <!--                Contextmenu-->
                <p:contextMenu for="tablapro">
                    <p:menuitem value="Modificar" icon="pi pi-pencil" oncomplete="PF('wdlgDatos').show()" update=":formModificar"/>
                    <p:menuitem value="Eliminar" icon="pi pi-trash" actionListener="#{ProductoC.eliminar()}" update="tablapro">
                        <p:confirm header="Confirmación" message="¿Deseas elimnar?"/>
                    </p:menuitem> 
                </p:contextMenu>
            </h:form>


            <p:dialog header="Datos del Producto" widgetVar="wdlgDatos" id="dlgDatos">
                <h:form id="formModificar">
                    <p:panelGrid columns="2">
                        <p:outputLabel value="Nombre" />
                        <p:inputText value="#{ProductoC.pro.nombre}" id="nombre"/>
                        <p:outputLabel value="Precio" />
                        <p:inputText value="#{ProductoC.pro.precio}"  id="Precio"/>

                        <p:outputLabel value="Tipo" />
                        <p:inputText value="#{ProductoC.pro.tipo}" id="tipo"/>

                        <p:outputLabel value="Stock" />
                        <p:inputText value="#{ProductoC.pro.stock}" id="stock"/>
                        <p:outputLabel value="Tamano" />
                        <p:inputText value="#{ProductoC.pro.tamano}"  id="tamano"/>
                        <p:outputLabel value="Detalle" />
                        <p:inputText value="#{ProductoC.pro.detalle}" id="detalle"/>
                        <p:commandButton value="Cancelar" immediate="true" oncomplete="PF('wdlgDatos').hide();" actionListener="#{ProductoC.limpiar()}" />
                        <p:commandButton id="modicardialog" value="Modificar" actionListener="#{ProductoC.modificar()}" 
                                         update="formModificar :MostrarProducto:tablapro" 
                                         oncomplete="if(!args.validationFailed)PF('wdlgDatos').hide();"/>
                    </p:panelGrid>
                </h:form>
            </p:dialog>
        </center>
    </h:body>
</html>
